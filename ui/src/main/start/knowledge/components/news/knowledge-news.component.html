<div class="news-three-column-layout" *ngIf="!showDetail">
  <!-- 左侧：类型卡片和标签筛选 -->
  <aside class="news-sidebar-left">
    <!-- 类型/来源卡片 -->
    <div class="news-source-card">
      <img [src]="selectedCategory?.avatar || 'assets/default-avatar.png'" alt="资讯" class="news-source-logo">
      <h3 class="news-source-title">{{ selectedCategory?.name || '资讯' }}</h3>
      <p class="news-source-desc">{{ selectedCategory?.description || '最新资讯动态' }}</p>
      <div class="news-source-follow">
        <button class="follow-btn">
          <i class="fas fa-plus"></i> 关注
        </button>
        <span>1,006,445 粉丝</span>
      </div>
    </div>

    <!-- 标签筛选 -->
    <div class="news-tags-filter">
      <h4>热门标签</h4>
      <div class="news-tags-list">
        <span class="news-tag">热点</span>
        <span class="news-tag">科技</span>
        <span class="news-tag">财经</span>
        <span class="news-tag">体育</span>
        <span class="news-tag">娱乐</span>
        <span class="news-tag">教育</span>
      </div>
    </div>
  </aside>

  <!-- 中间：资讯列表（可滚动） -->
  <div class="news-content" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50"
    (scrolled)="onScroll()">
    
    <!-- 调试信息 -->
    <div class="debug-info" style="background: #f0f0f0; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
      <p>实体数量: {{ entities.length }}</p>
      <p *ngIf="entities.length === 0">没有找到资讯数据，请检查数据源或标签配置</p>
    </div>
    
    <!-- 资讯列表 -->
    <div class="news-feed" *ngIf="entities.length > 0">
      <div *ngFor="let entity of entities; trackBy: trackByEntityId" class="news-item">
        <div class="news-item-header">
          <img class="news-publisher-avatar" [src]="entity['_source']?.avatar || 'assets/default-avatar.png'"
            alt="发布者">
          <span class="news-publisher-name">{{ entity['_source']?.source || '新华社' }}</span>
          <span class="news-publish-time">{{ entity['_source']?.publishTime || '2小时前' }}</span>
        </div>

        <div class="news-item-content" (click)="viewNewsDetail(entity._id)">
          <h3 class="news-item-title">{{ entity["_source"]?.labels?.zh?.value || '无标题' }}</h3>
          <div class="news-item-layout">
            <p class="news-item-desc">{{ entity["_source"]?.descriptions?.zh?.value || "暂无描述" }}</p>
            <img *ngIf="entity['_source']?.screenshot || (entity['_source']?.images?.length)"
              [src]="entity['_source']?.screenshot || entity['_source']?.images?.[0] || 'assets/default-news.png'"
              alt="资讯图片" class="news-item-img">
          </div>
        </div>

        <div class="news-item-actions">
          <span class="news-action"><i class="far fa-thumbs-up"></i> {{ entity['_source']?.likeCount || '0' }}</span>
          <span class="news-action"><i class="far fa-comment"></i> {{ entity['_source']?.commentCount || '0' }}</span>
          <span class="news-action"><i class="far fa-share-square"></i> 分享</span>
        </div>
      </div>
    </div>

    <!-- 空状态 -->
    <div class="empty-state" *ngIf="entities.length === 0">
      <div class="empty-content">
        <i class="fas fa-newspaper"></i>
        <h3>暂无资讯内容</h3>
        <p>请稍后再试或检查数据源配置</p>
      </div>
    </div>
  </div>

  <!-- 右侧：推荐内容 -->
  <aside class="news-sidebar-right">
    <div class="news-hot-recommend">
      <h4>热门推荐</h4>
      <ul class="news-recommend-list">
        <li *ngFor="let item of recommendList" class="news-recommend-item">
          <div class="news-recommend-title">
            <span class="news-recommend-num">{{ item.id }}</span>
            <span>{{ item.title }}</span>
          </div>
          <img [src]="item.image" alt="推荐新闻" class="news-recommend-img">
        </li>
      </ul>
    </div>
  </aside>
</div>

<!-- 新闻详情视图 -->
<div class="news-detail-container" *ngIf="showDetail">
  <div class="loading-container" *ngIf="loading">
    <div class="loading-spinner"></div>
    <p>加载中...</p>
  </div>

  <div class="news-content-container" *ngIf="!loading && currentNewsDetails">
    <!-- 头部信息 -->
    <header class="news-header">
      <!-- 返回按钮移到标题区域内 -->
      <div class="back-button" (click)="closeNewsDetail()">
        <i class="fas fa-arrow-left"></i> 返回资讯列表
      </div>
      
      <h1 class="news-title">{{ currentNewsDetails['_source']?.labels?.zh?.value }}</h1>
      <div class="news-meta">
        <div class="news-source">
          <img [src]="currentNewsDetails['_source']?.avatar || 'assets/default-avatar.png'" alt="来源" class="news-source-avatar">
          <span class="news-source-name">{{ currentNewsDetails['_source']?.source || '未知来源' }}</span>
        </div>
        <div class="news-info">
          <span class="news-publish-time">{{ currentNewsDetails['_source']?.publishTime || '未知时间' }}</span>
        </div>
      </div>
      <div class="news-tags" *ngIf="tags?.length">
        <span class="news-tag" *ngFor="let tag of tags">{{ tag }}</span>
      </div>
    </header>

    <!-- 封面图片 -->
    <div class="news-cover" *ngIf="currentNewsDetails['_source']?.screenshot || (currentNewsDetails['_source']?.images?.length > 0)">
      <img [src]="currentNewsDetails['_source']?.screenshot || currentNewsDetails['_source']?.images?.[0]" 
           alt="封面图片" class="cover-image">
    </div>

    <!-- 多媒体内容区域 -->
    <div class="media-content" *ngIf="hasMediaContent()">
      <!-- 图片展示 -->
      <div class="image-gallery" *ngIf="imgs?.length">
        <div class="image-item" *ngFor="let img of imgs">
          <img [src]="img.url" (click)="openImage(img.url)" alt="图片">
        </div>
      </div>
      
      <!-- 视频展示 -->
      <div class="video-gallery" *ngIf="videos?.length">
        <div class="video-item" *ngFor="let video of videos">
          <video controls>
            <source [src]="video.url" [type]="video.type">
            你的浏览器不支持视频播放
          </video>
        </div>
      </div>
      
      <!-- PDF展示 -->
      <div class="pdf-gallery" *ngIf="pdfs?.length">
        <div class="pdf-item" *ngFor="let pdf of pdfs">
          <div class="pdf-preview" (click)="openPdf(pdf.url)">
            <i class="fas fa-file-pdf"></i>
            <span>{{ pdf.name }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 资讯正文内容 -->
    <div class="news-body">
      <div *ngIf="content" [innerHTML]="content | safeHtml"></div>
      <div *ngIf="!content" class="news-description">
        {{ currentNewsDetails['_source']?.descriptions?.zh?.value || '暂无详细内容' }}
      </div>
    </div>

    <!-- 相关推荐 -->
    <div class="related-news" *ngIf="relatedNews?.length">
      <h3 class="related-title">相关资讯</h3>
      <div class="related-list">
        <div class="related-item" *ngFor="let news of relatedNews" (click)="viewNewsDetail(news.id)">
          <h4 class="related-item-title">{{ news.title }}</h4>
          <div class="related-item-meta">
            <span class="related-item-source">{{ news.source }}</span>
            <span class="related-item-time">{{ news.time }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
